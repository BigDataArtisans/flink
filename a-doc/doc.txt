

export FLINK_PROJECT=/work/projects/BigDataArtisans/flink-projects/flink
cd ${FLINK_PROJECT}/flink-runtime
mvn clean install -DskipTests=true -Dfast -T 2C -Dmaven.compile.fork=true -Dskip.npm -Dhadoop.version=2.7.5 -Dscala.version=2.11.12 -Dscala.binary.version=2.11

cd ${FLINK_PROJECT}/flink-dist
mvn clean install -DskipTests=true -Dfast -T 2C -Dmaven.compile.fork=true -Dskip.npm -Dhadoop.version=2.7.5 -Dscala.version=2.11.12 -Dscala.binary.version=2.11


export HADOOP_HOME=/work/BigData/install/hadoop/hadoop-2.6.0
export HADOOP_CONF_DIR=/work/BigData/install/hadoop/hadoop-2.6.0/etc/hadoop
export YARN_HOME=/work/BigData/install/hadoop/hadoop-2.6.0
export YARN_HOME_DIR=/work/BigData/install/hadoop/hadoop-2.6.0/etc/hadoop
cd ${FLINK_PROJECT}/flink-dist/target/flink-1.6.7-bin/flink-1.6.7
\cp /work/BigData/install/flink/config/flink-conf.yaml conf

bin/flink run -m yarn-cluster -d -yn 1 examples/streaming/SocketWindowWordCount.jar


/bin/bash bin/flink savepoint 9286756f9d0b7d6eef6c12d36f5153a0 -yid application_1570170136016_0503



RemoteRpcInvocation(heartbeatFromTaskManager(ResourceID, SlotReport))
RemoteRpcInvocation(heartbeatFromTaskManager(ResourceID, AccumulatorReport))
LocalRpcInvocation(triggerSavepoint(JobID, String, boolean, Time))
LocalRpcInvocation(triggerSavepoint(String, boolean, Time))


org.apache.flink.runtime.rpc.akka.AkkaRpcActor#handleRpcInvocation
String methodName = rpcInvocation.getMethodName();
if ("triggerSavepoint".equals(methodName)
    || "heartbeatFromTaskManager".equals(methodName)) {
    log.info(rpcInvocation.getMethodName() + " <--> " + Arrays.toString(rpcInvocation.getArgs()));
}





src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java:877
try {
    // System.out.println("completed sleep 2min");
    // TimeUnit.MINUTES.sleep(2);
} catch (Exception e) {
    e.printStackTrace();
}


LOG.info("Completed checkpoint {} for job {} ({} bytes in {} ms).", checkpointId, job,
    completedCheckpoint.getStateSize(), completedCheckpoint.getDuration());





org.apache.flink.runtime.rpc.akka.AkkaRpcActor#handleRpcMessage

JM
heartbeatFromResourceManager [a04c2bfc743fabbfda157d81609b3246]
heartbeatFromTaskManager [container_1570170136016_0416_01_000002, SlotReport{slotsStatus=[SlotStatus{slotID=container_1570170136016_0416_01_000002_0, resourceProfile=ResourceProfile{cpuCores=1.0, heapMemoryInMB=42, directMemoryInMB=0, nativeMemoryInMB=0, networkMemoryInMB=0}, allocationID=AllocationID{b439d08caacf0b9ac6613aef06b9741d}, jobID=935eaa450b0fbae2cd8efb617c321c7a}, SlotStatus{slotID=container_1570170136016_0416_01_000002_1, resourceProfile=ResourceProfile{cpuCores=1.0, heapMemoryInMB=42, directMemoryInMB=0, nativeMemoryInMB=0, networkMemoryInMB=0}, allocationID=AllocationID{a13771be72ea6c5cdb0164563cb8ec82}, jobID=935eaa450b0fbae2cd8efb617c321c7a}]}]

TM
heartbeatFromResourceManager [a04c2bfc743fabbfda157d81609b3246]
heartbeatFromJobManager [305c4b9a12356465f674f378ac6a6b7b]







HeartbeatManagerImpl cancelTimeoutjava.lang.Exception: HeartbeatManagerImpl cancelTimeout
	at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl$HeartbeatMonitor.cancelTimeout(HeartbeatManagerImpl.java:350)
	at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl$HeartbeatMonitor.resetHeartbeatTimeout(HeartbeatManagerImpl.java:331)
	at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl$HeartbeatMonitor.reportHeartbeat(HeartbeatManagerImpl.java:326)
	at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl.reportHeartbeat(HeartbeatManagerImpl.java:237)
	at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl.receiveHeartbeat(HeartbeatManagerImpl.java:195)
	at org.apache.flink.runtime.jobmaster.JobMaster.heartbeatFromTaskManager(JobMaster.java:904)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcInvocation(AkkaRpcActor.java:242)
	at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:162)
	at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:70)
	at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.onReceive(AkkaRpcActor.java:142)
	at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.onReceive(FencedAkkaRpcActor.java:40)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:165)
	at akka.actor.Actor$class.aroundReceive(Actor.scala:502)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:95)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526)
	at akka.actor.ActorCell.invoke(ActorCell.scala:495)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)
	at akka.dispatch.Mailbox.run(Mailbox.scala:224)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:234)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)



"flink-akka.actor.default-dispatcher-4" #19 prio=5 os_prio=0 tid=0x0000000001e2e000 nid=0x2bfe waiting for monitor entry [0x00007f0c4930b000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.triggerCheckpoint(CheckpointCoordinator.java:414)
        - waiting to lock <0x00000000e5fa6140> (a java.lang.Object)
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.triggerSavepoint(CheckpointCoordinator.java:370)
        at org.apache.flink.runtime.jobmaster.JobMaster.triggerSavepoint(JobMaster.java:944)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcInvocation(AkkaRpcActor.java:247)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:162)
        at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:70)at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.onReceive(AkkaRpcActor.java:142)
        at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.onReceive(FencedAkkaRpcActor.java:40)
        at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:165)
        at akka.actor.Actor$class.aroundReceive(Actor.scala:502)
        at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:95)
        at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526)
        at akka.actor.ActorCell.invoke(ActorCell.scala:495)
        at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)
        at akka.dispatch.Mailbox.run(Mailbox.scala:224)
        at akka.dispatch.Mailbox.exec(Mailbox.scala:234)
        at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
        at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
        at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
        at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
